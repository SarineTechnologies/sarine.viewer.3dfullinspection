/*!
sarine.viewer.3dfullinspection - v0.0.5 -  Thursday, March 12th, 2015, 1:27:34 PM 
 The source code, name, and look and feel of the software are Copyright Â© 2015 Sarine Technologies Ltd. All Rights Reserved. You may not duplicate, copy, reuse, sell or otherwise exploit any portion of the code, content or visual design elements without express written permission from Sarine Technologies Ltd. The terms and conditions of the sarine.com website (http://sarine.com/terms-and-conditions/) apply to the access and use of this software.
 */
(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};b=function(){function a(b){this.first_init_defer=$.Deferred(),this.full_init_defer=$.Deferred(),this.src=b.src,this.element=b.element,this.autoPlay=b.autoPlay,this.callbackPic=b.callbackPic,this.id=this.element[0].id,this.element=this.convertElement(),Object.getOwnPropertyNames(a.prototype).forEach(function(a){return"Error"===this[a].name?console.error(this.id,a,"Must be implement",this):void 0},this),this.element.data("class",this),this.element.on("play",function(a){return $(a.target).data("class").play.apply($(a.target).data("class"),[!0])}),this.element.on("stop",function(a){return $(a.target).data("class").stop.apply($(a.target).data("class"),[!0])}),this.element.on("cancel",function(a){return $(a.target).data("class").cancel().apply($(a.target).data("class"),[!0])})}var b,c;return c=ResourceManager.getInstance(),b=function(){return console.error(this.id,"must be implement")},a.prototype.first_init=Error,a.prototype.full_init=Error,a.prototype.play=Error,a.prototype.stop=Error,a.prototype.convertElement=Error,a.prototype.cancel=function(){return c.cancel(this)},a.prototype.loadImage=function(a){return c.loadImage.apply(this,[a])},a.prototype.setTimeout=function(){return c.setTimeout.apply(this,[this.delay])},a}(),this.Viewer=b,a=function(a){function b(a){this.full_init=c(this.full_init,this),this.first_init=c(this.first_init,this),this.convertElement=c(this.convertElement,this),this.preloadAssets=c(this.preloadAssets,this),this.resourcesPrefix="http://dev.sarineplatform.com/qa4/content/viewers/atomic/v1/assets/",b.__super__.constructor.call(this,a),this.jsonsrc=a.jsonsrc}var d,f,g,h,i,j;return e(b,a),b.prototype.preloadAssets=function(a){var b,c,d,e,f,g,h,i,j;for(e=[{element:"script",src:"jquery-ui.js"},{element:"script",src:"jquery.ui.ipad.altfix.js"},{element:"script",src:"momentum.js"},{element:"script",src:"mglass.js"},{element:"link",src:"inspection.css"}],c=0,f=e.map(function(a){return"script"===a.element}),g=function(a){return c++,c===f.length-1&&void 0!==a?a():void 0},j=[],h=0,i=e.length;i>h;h++)d=e[h],b=document.createElement(d.element),"script"===d.element?($(document.body).append(b),b.onload=b.onreadystatechange=function(){return g(a)},b.src=this.resourcesPrefix+d.src,j.push(b.type="text/javascript")):(b.href=this.resourcesPrefix+d.src,b.rel="stylesheet",b.type="text/css",j.push($(document.head).prepend(b)));return j},b.prototype.convertElement=function(){var a;return a=this.resourcesPrefix+"3dfullinspection.html",$.get(a,function(a){return function(b){return a.conteiner=b,a.element.append(b)}}(this)),this.element},b.prototype.first_init=function(){var a,b,c;return this.first_init_defer=$.Deferred(),this.full_init_defer=$.Deferred(),c="",b=function(a){return function(b){return a.viewerBI=new i({first_init:a.first_init_defer,full_init:a.full_init_defer,src:a.src,x:0,y:b.vertical_angles.indexOf(90),stone:c,friendlyName:"temp",cdn_subdomain:!1,metadata:b,debug:!1}),a.UIlogic=new h(a.viewerBI,{auto_play:!0}),a.UIlogic.go()}}(this),a=this.src+this.jsonsrc,$.getJSON(a,function(a){return function(e){var f;return c=e.StoneId+"_"+e.MeasurementId,f=new d({size_x:e.number_of_x_images,flip_from_y:e.number_of_y_images,background:e.background,vertical_angles:e.vertical_angles,num_focus_points:e.num_focus_points,shooting_parameters:e.shooting_parameters}),a.preloadAssets(function(){return b(f)})}}(this)).fail(function(){return $(".inspect-stone").addClass("no_stone")}),this.first_init_defer},b.prototype.full_init=function(){return this.viewerBI.preloader.go(),this.full_init_defer},b.prototype.nextImage=function(){return console.log("FullInspection: nextImage")},b.prototype.play=function(){},b.prototype.stop=function(){},g=4,j={sprite_factors:"2,4",image_quality:70,sprite_quality:30,image_size:480,speed:240,initial_focus:0,initial_zoom:"large",background:"000000",machineEndPoint:"http://localhost:8735/Sarin.Agent",local:!1},d=function(){function a(a){var b,c,d,e,f,h,i,k,l,m,n,o,p,q,r,s,t,u,v;for(t=["background","initial_zoom","sprite_factors","shooting_parameters","local"],n=0,q=t.length;q>n;n++)k=t[n],this[k]=a[k]||j[k];for(u=["size_x","flip_from_y","num_focus_points","image_quality","sprite_quality","speed","initial_focus","speed"],o=0,r=u.length;r>o;o++)k=u[o],this[k]=a[k]||j[k];if(a.vertical_angles)this.vertical_angles=a.vertical_angles;else{for(m=[],h=0;h<this.flip_from_y;)m[h]=parseInt(h/(this.flip_from_y-1)*180-90),h++;this.vertical_angles=m}if(this.background=this.background.replace("#",""),this.sprite_factors=function(){var a,b,c,e;for(c=this.sprite_factors.split(","),e=[],a=0,b=c.length;b>a;a++)d=c[a],e.push(parseInt(d));return e}.call(this),this.sprite_factors.sort(),this.size_y=2*(this.flip_from_y-1)-1,this.num_images=this.size_x*this.flip_from_y,this.num_sprite_images=this.num_images/g,this.sprite_num_y=Math.floor(Math.sqrt(this.num_sprite_images)),this.sprite_num_x=Math.ceil(this.num_sprite_images/this.sprite_num_x),null!=this.shooting_parameters){this.focus_points=[],this.vertical_angles=[];for(b in this.shooting_parameters){this.vertical_angles.push(parseInt(b));for(f in this.shooting_parameters[b].Focuses)-1===this.focus_points.indexOf(this.shooting_parameters[b].Focuses[f])&&this.focus_points.push(this.shooting_parameters[b].Focuses[f])}for(this.focus_points.sort(function(a,b){return a-b}),this.vertical_angles.sort(function(a,b){return a-b}),this.focus_index={},v=this.focus_points,i=p=0,s=v.length;s>p;i=++p)e=v[i],this.focus_index[e]=i;this.angle_focus_info=function(){var a,d,e,g;for(e=this.vertical_angles,g=[],a=0,d=e.length;d>a;a++)b=e[a],c=this.shooting_parameters[""+b],l=function(){var a,b,d,e;for(d=c.Focuses,e=[],b=0,a=d.length;a>b;b++)f=d[b],e.push(this.focus_index[f]);return e}.call(this),g.push({"default":this.focus_index[c.DefaultFocus],supported:l});return g}.call(this)}}return a.prototype.default_focus=function(a,b){return null!=this.angle_focus_info?this.angle_focus_info[this.normal_y(b)]["default"]:0},a.prototype.normal_y=function(a){var b;return b=a,a>Math.floor(this.size_y/2+1)&&(b=this.size_y-a+1),b},a.prototype.supported_focus_indexes=function(a,b){var c;return null!=this.shooting_parameters?this.angle_focus_info[this.normal_y(b)].supported:function(){c=[];for(var a=0,b=this.num_focus_points-1;b>=0?b>=a:a>=b;b>=0?a++:a--)c.push(a);return c}.apply(this)},a.prototype.number_focuses=function(){},a.prototype.next_focus=function(a,b,c){var d,e;return d=this.supported_focus_indexes(a,b),e=d.indexOf(c),e===d.length-1?null:d[e+1]},a.prototype.prev_focus=function(a,b,c){var d,e;return d=this.supported_focus_indexes(a,b),e=d.indexOf(c),0===e?null:d[e-1]},a.prototype.image_name=function(a,b,c){return null==c&&(c=this.default_focus(a,this.normal_y(b))),null!=this.shooting_parameters?""+a+"_"+this.normal_y(b)+"_"+c:c*this.num_images+(this.normal_y(b)*this.size_x+a)},a.prototype.image_class=function(a,b,c){return null==c&&(c=this.default_focus(a,this.normal_y(b))),null!=this.shooting_parameters?""+a+"_"+this.normal_y(b)+"_"+j.sprite_quality:c*this.num_images+(this.normal_y(b)*this.size_x+a)},a.prototype.focus_label=function(){return null!=this.shooting_parameters?"":"_0"},a.prototype.hq_trans=function(){return null!=this.shooting_parameters?"c_scale,h_480,q_"+this.image_quality+",w_480":"q_"+this.image_quality},a.prototype.inc_x=function(a,b){return(a+b+this.size_x)%this.size_x},a.prototype.inc_y=function(a,b){return(a+b+this.size_y)%this.size_y},a.prototype.multi_focus=function(){return null!=this.shooting_parameters||this.num_focus_points>1},a}(),f=function(){function a(a,b,c,d){this.callback=a,this.widget=b,this.metadata=c,this.version=0,this.dest=d.src,this.clear_queue(),this.images={},this.totals={},this.stone=d.stone,this.cdn_subdomain=d.cdn_subdomain&&"http:"===window.location.protocol&&!j.local,this.density=d.density||1}return a.prototype.cache_key=function(){return this.trans},a.prototype.configure=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;for(this.trans=a,this.x=b,this.y=c,(f=this.images)[k=this.cache_key()]||(f[k]={}),e=0,this.clear_queue(),b=g=0,l=this.metadata.size_x-1;l>=0?l>=g:g>=l;b=l>=0?++g:--g)for(c=h=0,m=this.metadata.flip_from_y-1;m>=0?m>=h:h>=m;c=m>=0?++h:--h)for(n=this.metadata.supported_focus_indexes(b,c),i=0,j=n.length;j>i;i++)d=n[i],this.has(b,c,d)&&this.loaded++,e++;return this.totals[this.cache_key()]=e},a.prototype.clear_queue=function(){return this.version++,this.loaded=0,this.queue={},this.queue.all=[]},a.prototype.go=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;for(f=h=0,m=this.metadata.size_x-1;m>=0?m>=h:h>=m;f=m>=0?++h:--h)for(g=i=0,n=this.metadata.flip_from_y-1;n>=0?n>=i:i>=n;g=n>=0?++i:--i)for(o=this.metadata.supported_focus_indexes(f,g),j=0,l=o.length;l>j;j++)a=o[j],this.has(f,g,a)||(e=this.src(f,g,a),d="all",this.queue[d].push({src:e,x:f,y:g,focus:a,trans:this.trans,version:this.version}));for(this.prioritize(),p=[],b=k=0;2>=k;b=++k)p.push(function(){var a,b;a=this.queue,b=[];for(d in a)c=a[d],b.push(this.preload(c));return b}.call(this));return p},a.prototype.circle_distance=function(a,b,c){return Math.min((a-b+c)%c,(b-a+c)%c)},a.prototype.prioritize=function(){var a,b,c,d,e,f,h,i;h=this.queue,i=[];for(d in h){for(c=h[d],e=0,f=c.length;f>e;e++)a=c[e],b=this.circle_distance(a.x,this.x,this.metadata.size_x)+50*Math.pow(this.circle_distance(a.y,this.y,this.metadata.flip_from_y),2),a.x%g!==0&&(b+=this.metadata.size_x/2),a.priority=b;i.push(c.sort(function(a,b){return b.priority-a.priority}))}return i},a.prototype.load_image=function(a,b,c,d,e){var f,g,h,i;return f=this.cache_key(),h=this.trans,i=this.version,g=new Image,g.src=d,g.onload=function(g){return function(){var j,k;return j=g.metadata.image_name(a,b,c),k=!g.images[f][j],g.images[f][j]=!0,g.version===i&&(k&&g.loaded++,g.callback(h,a,b,c,d),null!=e)?g.preload(e):void 0}}(this),g.onerror=g.onload},a.prototype.total=function(){return this.totals[this.cache_key()]},a.prototype.preload=function(a){var b;if(0!==a.length)return b=a.pop(),this.load_image(b.x,b.y,b.focus,b.src,a)},a.prototype.has=function(a,b,c){return null==c&&(c=this.metadata.default_focus(a,b)),this.images[this.cache_key()][this.metadata.image_name(a,b,c)]===!0},a.prototype.src=function(a,b,c,d){var e,f,g;return null==d&&(d=""),a=Math.floor(a/this.density)*this.density,e={format:"jpg",quality:null!=(f=d.quality)?f:j.image_quality,height:null!=(g=d.height)?g:j.image_size},this.dest+"/"+e.height+"_"+e.quality+"/img_"+this.metadata.image_name(a,b,c)+".jpg"},a.prototype.fetch=function(a,b,c){var d,e,f,g,h;return null==c&&(c=null),g=[this.x,a],d=g[0],this.x=g[1],h=[this.y,b],e=h[0],this.y=h[1],(this.circle_distance(a,d,this.metadata.size_x)>20||b!==e)&&(this.widget.trigger("preload_xy",{x:a,y:b}),this.prioritize()),f=this.src(a,b,c),this.has(a,b,c)?this.callback(this.trans,a,b,c,f):this.load_image(a,b,c,f)},a}(),i=function(){function a(a){this.img_ready=c(this.img_ready,this),this.widget=$(".inspect-stone"),this.viewport=$(".inspect-stone > .viewport"),this.inited=!1,this.first_hit=!0,this.debug=a.debug,this.metadata=a.metadata,this.stone=a.stone,this.friendlyName=a.friendlyName,this.density=a.density||1,this.x=a.x,this.y=a.y,this.focus=this.metadata.initial_focus,this.preloader=new f(this.img_ready,this.widget,this.metadata,a),this.mode="large",this.inspection=!1,this.dest=a.src,this.first_init_defer=a.first_init,this.full_init_defer=a.full_init,this.reset()}return a.prototype.reset=function(){return this.stop(),this.widget.trigger("reset")},a.prototype.configure=function(a){return this.trans=a,this.stop(),this.preloader.configure(this.trans,this.x,this.y)},a.prototype.img_ready=function(a,b,c,d,e){return this.preloader.total()===this.preloader.loaded&&this.full_init_defer.resolve(this),this.first_hit&&(this.first_hit=!1,this.first_init_defer.resolve(this)),this.widget.trigger("high_quality",{loaded:Math.floor(this.preloader.loaded/this.density),total:Math.floor(this.preloader.total()/this.density)}),b===this.x&&c===this.y&&d===this.focus&&a===this.trans?(this.widget.removeClass("sprite"),$("#main-image").attr({src:e}),this.viewport.attr({"class":this.flip_class()})):void 0},a.prototype.left=function(a){return null==a&&(a=1),this.direction="left",this.move_horizontal(a)},a.prototype.right=function(a){return null==a&&(a=1),this.direction="right",this.move_horizontal(a)},a.prototype.move_horizontal=function(a){return this.active?(a=Math.ceil(a/this.density)*this.density,"right"===this.direction&&(a=-a),this.x=this.metadata.inc_x(this.x,a),this.show()):void 0},a.prototype.up=function(a){var b,c;return null==a&&(a=1),this.active?(c=this.flip(),this.direction="up",this.y=this.metadata.inc_y(this.y,-a),c!==this.flip()&&(b=(this.x+Math.floor(this.metadata.size_x/2))%this.metadata.size_x,this.x=this.metadata.inc_x(this.x,b-this.x)),this.fix_focus(),this.show()):void 0},a.prototype.down=function(a){var b,c;return null==a&&(a=1),this.active?(c=this.flip(),this.direction="down",this.y=this.metadata.inc_y(this.y,a),c!==this.flip()&&(b=(this.x+Math.floor(this.metadata.size_x/2))%this.metadata.size_x,this.x=this.metadata.inc_x(this.x,b-this.x)),this.fix_focus(),this.show()):void 0},a.prototype.flip=function(){return this.y>=this.metadata.flip_from_y},a.prototype.flip_class=function(){return this.flip()?"viewport flip":"viewport"},a.prototype.fix_focus=function(){return-1===this.metadata.supported_focus_indexes(this.x,this.y).indexOf(this.focus)?this.focus=this.metadata.default_focus(this.x,this.y):void 0},a.prototype.at_top=function(){return this.y===this.metadata.flip_from_y-1},a.prototype.top_view=function(){var a;return this.direction="up",a=this.metadata.vertical_angles.indexOf(90),-1!==a&&(this.y=a),this.fix_focus(),this.active?this.show():void 0},a.prototype.at_bottom=function(){return this.y===this.metadata.vertical_angles.indexOf(-90)},a.prototype.bottom_view=function(){var a;return this.direction="up",a=this.metadata.vertical_angles.indexOf(-90),-1!==a&&(this.y=a),this.fix_focus(),this.active?this.show():void 0},a.prototype.at_middle=function(){return this.y===this.metadata.vertical_angles.indexOf(0)},a.prototype.magnify=function(){},a.prototype.middle_view=function(){var a;return this.direction="up",a=this.metadata.vertical_angles.indexOf(0),-1!==a&&(this.y=a),this.fix_focus(),this.active?this.show():void 0},a.prototype.view_mode=function(){return this.at_top()?"top":this.at_middle()?"side":this.at_bottom()?"bottom":null},a.prototype.stop=function(){return this.player?clearInterval(this.player):void 0},a.prototype.play=function(){return this.stop(),this.player=setInterval(function(a){return function(){return a.left(),a.metadata.speed*a.density}}(this))},a.prototype.show=function(a){var b,c,d,e,f,h;if(this.widget.trigger("xy",{x:this.x,y:this.y}),this.timeout&&clearTimeout(this.timeout),e=c=0,f=this.x,h=this.flip()?this.metadata.size_y+1-this.y:this.y,!a){for(d="left"===this.direction?1:-1,b=!this.preloader.has(f,h);!this.preloader.has(f,h)&&f%g!==0;)f=this.metadata.inc_x(f,d);if(b&&(("up"===this.direction||"down"===this.direction)&&(this.x=f),this.timeout=setTimeout(function(a){return function(){return a.timeout=null,a.show(!0)}}(this),50),f%g===0))return this.load_from_sprite();this.load_from_sprite()}return this.preloader.fetch(this.x,this.y,this.focus)},a.prototype.sprite_info=function(a,b,c){var d;return null==a&&(a=this.sprite_size),null==b&&(b=this.x),null==c&&(c=this.y),d="zoom_"+this.size+"_"+a+"_"+j.sprite_quality+"_",$("#info_inspection").removeClass().addClass(""+d+this.stone+"_img_"+this.metadata.image_name(b,c))},a.prototype.load_from_sprite=function(){var a,b,c,d,e,f,g,h,i,j;return c=this.sprite_info(),b=c.css("background-position-y"),a=c.css("background-position-x"),j=c.css("background-position").split(" "),a=j[0],b=j[1],f=parseInt(b.replace(/px/,"")),e=parseInt(a.replace(/px/,"")),i=-f/this.sprite_size,h=-i*this.size*this.sprite_size/this.sprite_size,d=e*this.size/this.sprite_size,g=this.get_sprite_image(c),g?(this.widget.addClass("sprite"),$("#sprite-image").attr({src:g}).css({top:h,left:d}),this.viewport.attr({"class":this.flip_class()})):void 0},a.prototype.get_sprite_image=function(a){var b;return b=a.css("background-image").match(/url\("?([^"]*)"?\)/),b?b[1]:null},a.prototype.load_stylesheet=function(a,b,c){var d,e,f;return j.local?void c():(0===$('link[href="'+a+'"]').length&&(e=$("<link></link>").attr({href:a,rel:"stylesheet",type:"text/css"}),e.appendTo($("head"))),f=this.size,(d=function(a){return function(){var e,g,h;return g=a.sprite_info(b,0,0),h=a.get_sprite_image(g),null!=h?(e=new Image,e.src=h,e.startLoadStamp=new Date,e.cached=e.complete?!0:!1,e.onload=function(){var d;return e.endLoadStamp=new Date,d=e.endLoadStamp.getTime()-e.startLoadStamp.getTime(),f===a.size&&a.widget.find("#sprite-image").css({width:a.metadata.sprite_num_x*b*a.size/b,height:a.metadata.sprite_num_y*b*a.size/b}),c()}):setTimeout(d,50)}}(this))())},a.prototype.zoom_large=function(){return this.widget.removeClass("small").addClass("large"),this.mode="large",this.zoom(480,this.metadata.hq_trans(),0)},a.prototype.zoom_small=function(){return this.widget.removeClass("large").addClass("small"),this.mode="small",this.zoom(320,"c_scale,h_320,q_"+this.metadata.image_quality+",w_320",0)},a.prototype.mode=function(){return this.mode},a.prototype.change_focus=function(a){return this.focus=a,this.show()},a.prototype.next_focus=function(){return this.metadata.next_focus(this.x,this.y,this.focus)},a.prototype.prev_focus=function(){return this.metadata.prev_focus(this.x,this.y,this.focus)},a.prototype.zoom=function(a,b){var c,d,e,f,g;return this.currentDownloadImagesLabel=a+"_"+b,this.currentDownloadImagesTimeStart=new Date,this.size=a,g=this.metadata.sprite_factors,d=g[0],f=g[1],this.sprite_size=Math.floor(this.size/f),this.configure(b),c={crop:"scale",format:"css",fetch_format:"jpg",type:"sprite",viewer:"Inspection",height:this.size,width:this.size,quality:this.metadata.sprite_quality,background:"#"+this.metadata.background},e=this.dest+("/InspectionSprites/"+this.size+"_"+this.sprite_size+"_"+this.metadata.sprite_quality+"_sprite.css"),this.reset(),this.show(!0),this.load_stylesheet(e,this.sprite_size,function(a){return function(){return a.widget.trigger("low_quality")}}(this))},a}(),h=function(){function a(a,b){this.viewer=a,this.auto_play=b.auto_play}return a.prototype.disable_button=function(a){return $(a).each(function(){return function(a,b){return $(b).data("enabled",!1),$(b).addClass("disabled")}}(this))},a.prototype.enable_button=function(a){return $(a).each(function(){return function(a,b){return $(b).data("enabled",!0),$(b).removeClass("disabled")}}(this))},a.prototype.activate_button=function(a){return $(a).each(function(){return function(a,b){return $(b).data("active",!0),$(b).addClass("selected")}}(this))},a.prototype.inactivate_button=function(a){return $(a).each(function(){return function(a,b){return $(b).data("active",!1),$(b).removeClass("selected")}}(this))},a.prototype.update_focus_buttons=function(){return this.disable_button(".focus_out"),this.disable_button(".focus_in"),this.inactivate_button(".focus_out"),this.inactivate_button(".focus_in"),$("#focus_label_quantity").html(this.viewer.metadata.angle_focus_info[this.viewer.metadata.normal_y(this.viewer.y)].supported.length),$("#focus_label_current").html(this.viewer.focus+1),null!=this.viewer.next_focus()||null!=this.viewer.prev_focus()?(null!=this.viewer.prev_focus()?this.enable_button(".focus_out"):(this.activate_button(".focus_out"),this.disable_button(".focus_out")),null!=this.viewer.next_focus()?this.enable_button(".focus_in"):(this.activate_button(".focus_in"),this.disable_button(".focus_in"))):void 0},a.prototype.stop=function(){return this.viewer.active&&$(".player .pause").data("active")?(this.activate_button($(".player .hand_tool")),this.inactivate_button($(".player .pause")),$(".player .pause").addClass("hidden"),$(".player .play").removeClass("hidden"),this.viewer.stop(),this.auto_play=!1,!1):!1},a.prototype.play=function(){return $(".player .play").data("enabled")?($(".player .play").addClass("hidden"),$(".player .pause").removeClass("hidden"),this.activate_button($(".player .pause")),this.inactivate_button($(".player .hand_tool")),this.viewer.play(),!1):!1},a.prototype.go=function(){return this.viewer.inited=!0,this.update_focus_buttons(),this.mouse_x=null,this.mouse_y=null,$(window).keydown(function(a){return function(b){switch(b.keyCode){case 32:$(".player .pause").data("active")?a.stop():a.play();break;case 37:a.stop(),a.viewer.left();break;case 38:a.stop(),a.viewer.up();break;case 39:a.stop(),a.viewer.right();break;case 40:a.stop(),a.viewer.down();break;case 49:a.viewer.top_view();break;case 50:a.viewer.middle_view();break;case 51:a.viewer.bottom_view();break;case 107:if(!a.viewer.active)return!1;if(null==a.viewer.next_focus())return!1;a.viewer.change_focus(a.viewer.next_focus()),a.update_focus_buttons();break;case 109:if(!a.viewer.active)return!1;if(null==a.viewer.prev_focus())return!1;a.viewer.change_focus(a.viewer.prev_focus()),a.update_focus_buttons();break;default:return!0}return!1}}(this)),this.viewer.widget.focus().addTouch().mousedown(function(a){return function(b){return a.mouse_x=b.clientX,a.mouse_y=b.clientY,b.preventDefault(),!0}}(this)).elasticmousedrag(function(a){return function(b){var c,d,e;if(null!==a.mouse_x&&null!==a.mouse_y)return a.stop(),e=4,c=Math.round(Math.abs(b.clientX-a.mouse_x)*e/100),c>0&&(b.clientX>a.mouse_x?a.viewer.right(c):a.viewer.left(c),a.mouse_x=b.clientX),d=Math.round(Math.abs(b.clientY-a.mouse_y)*e/50),d>0?(b.clientY>a.mouse_y?a.viewer.down(d):a.viewer.up(d),a.mouse_y=b.clientY):void 0}}(this)).click(function(){return this.focus()}).bind("reset",function(a){return function(){return $(".display > div").html(""),a.viewer.active=!1,a.inactivate_button($(".button")),a.disable_button($(".button")),$(".player .pause").addClass("hidden"),$(".player .play").removeClass("hidden"),$(".progress").stop(!0).css({opacity:100}).show().addClass("active"),$(".progress").find(".progress_bar").css("width","0%"),$(".progress").find(".progress_percent").html("0%"),"large"===a.viewer.mode?(a.inactivate_button($(".small_link")),a.enable_button($(".small_link")),a.activate_button($(".large_link")),a.disable_button($(".large_link"))):(a.activate_button($(".small_link")),a.enable_button($(".large_link")),a.inactivate_button($(".large_link")),a.disable_button($(".small_link"))),a.update_focus_buttons()}}(this)).bind("low_quality",function(a){return function(){return $(".low_quality").html("Low quality images loaded"),a.viewer.active=!0,a.enable_button($(".inspect-stone .buttons li")),a.viewer.metadata.vertical_angles.indexOf(90)===!1&&a.disable_button(".top"),a.viewer.metadata.vertical_angles.indexOf(0)===!1&&a.disable_button(".middle"),a.viewer.metadata.vertical_angles.indexOf(-90)===!1&&a.disable_button(".bottom"),a.viewer.top_view(),a.update_focus_buttons()}}(this)).bind("med_quality",function(){return function(){return $(".med_quality").html("Medium quality images loaded")}}(this)).bind("high_quality",function(a){return function(b,c){var d,e,f;return $(".high_quality").html(""+c.loaded+" / "+c.total),e=Math.round(100*c.loaded/c.total),f=$(".progress"),$(f).find(".progress_bar").css("width",Math.min(e,98)+"%"),$(f).find(".progress_percent").html(e+"%"),100===e&&$(f).animate({opacity:0},2e3),c.loaded===c.total&&!$(".player .play").data("enabled")&&(d=(new Date).getTime()-a.viewer.currentDownloadImagesTimeStart.getTime(),a.enable_button($(".player .play, .player .pause")),a.auto_play)?a.play():void 0}}(this)).bind("xy",function(a){return function(b,c){return $(".xy").html((a.viewer.metadata.multi_focus()?""+a.viewer.focus+":":"")+(""+c.y+":"+c.x)),a.update_focus_buttons(),a.inactivate_button($(".inspect-stone .buttons li")),a.viewer.view_mode()?a.activate_button($(".inspect-stone .buttons ."+a.viewer.view_mode())):void 0}}(this)).bind("preload_xy",function(){return function(a,b){return $(".preload_xy").html("Preload center moved to "+b.y+":"+b.x)}}(this)),$(".inspect-stone").css("background-color","#"+this.viewer.metadata.background),"000"!==this.viewer.metadata.background&&"000000"!==this.viewer.metadata.background&&"black"!==this.viewer.metadata.background&&$(".inspect-stone").addClass("dark"),this.viewer.debug&&$(".display").show(),$(".player .play").click(function(a){return function(){return a.play()}}(this)),$(".player .hand_tool, .player .pause").click(function(a){return function(){return a.stop()}}(this)),$(".inspect-stone .buttons li:not(.magnify, .clickable, .focus_out, .focus_in)").click(function(a){return function(b){return $(b.target).data("button")?a.viewer.active?(a.viewer[$(b.target).data("button")](),!1):!1:void 0}}(this)),$(".small_link").click(function(a){return function(){return a.viewer.zoom_small(),!1}}(this)),$(".large_link").click(function(a){return function(){return a.enable_button(".magnify"),a.viewer.zoom_large(),!1}}(this)),$(".focus_in").click(function(a){return function(){return a.viewer.active?null==a.viewer.next_focus()?!1:(a.viewer.change_focus(a.viewer.next_focus()),a.update_focus_buttons(),!1):!1}}(this)),$(".focus_out").click(function(a){return function(){return a.viewer.active?null==a.viewer.prev_focus()?!1:(a.viewer.change_focus(a.viewer.prev_focus()),a.update_focus_buttons(),!1):!1}}(this)),$(".magnify").click(function(a){return function(){var b;return a.viewer.inspection?(a.viewer.active=!0,$(".inspect-stone").css("overflow","hidden"),$(document).unbind("mouseup"),a.viewer.MGlass.Delete(),a.inactivate_button($(".magnify")),$(".inspect-stone .buttons li:not(.magnify)").removeClass("disabled"),a.update_focus_buttons()):(a.viewer.active=!1,$(document).mouseup(function(a){var b;return b=$(".mglass_viewer,.magnify"),b.is(a.target)||0!==b.has(a.target).length?void 0:setTimeout(function(){return $(".magnify").click()},0)}),$(".inspect-stone .buttons li:not(.magnify)").addClass("disabled"),$(".magnify").show(),$(".inspect-stone").css("overflow","visible"),$(".inspect-stone").css("overflow","visible"),0===$("mglass_wrapper").length&&(b=a.viewer.preloader.src(a.viewer.x,a.viewer.y,a.viewer.focus,{height:0,width:0,quality:70}),a.viewer.MGlass=new MGlass("main-image",b,{background:a.viewer.metadata.background},arguments.callee)),a.inactivate_button($(".focus_out")),a.inactivate_button($(".focus_in")),a.disable_button(".focus_out"),a.disable_button(".focus_in"),a.activate_button($(".magnify"))),a.viewer.inspection=!a.viewer.inspection}}(this)),"small"===this.viewer.metadata.initial_zoom?this.viewer.zoom_small():this.viewer.zoom_large(),this.update_focus_buttons()},a}(),b}(b),this.FullInspection=a}).call(this);