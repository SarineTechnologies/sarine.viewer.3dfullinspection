/*!
sarine.viewer.3dfullinspection - v0.51.0 -  Tuesday, January 23rd, 2018, 11:51:17 AM 
 The source code, name, and look and feel of the software are Copyright Â© 2015 Sarine Technologies Ltd. All Rights Reserved. You may not duplicate, copy, reuse, sell or otherwise exploit any portion of the code, content or visual design elements without express written permission from Sarine Technologies Ltd. The terms and conditions of the sarine.com website (http://sarine.com/terms-and-conditions/) apply to the access and use of this software.
 */
(function(){var a,b,c=function(a,b){return function(){return a.apply(b,arguments)}},d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=function(a){function b(a){this.full_init=c(this.full_init,this),this.first_init=c(this.first_init,this),this.convertElement=c(this.convertElement,this),this.preloadAssets=c(this.preloadAssets,this),n=new queryString,l="true"===n.getValue("isLocal"),this.resourcesPrefix=a.baseUrl+"atomic/v1/assets/",this.setMagnifierLibName(),this.cdn_subdomains=void 0!==window.cdn_subdomains?window.cdn_subdomains:[],this.resources=[{element:"script",src:"jquery-ui.js"},{element:"script",src:"jquery.ui.ipad.altfix.js"},{element:"script",src:"momentum.js"},{element:"link",src:"inspection.css"}],"cloudzoom"===m?this.resources.push({element:"script",src:"cloudzoom.js"}):"mglass"===m&&this.resources.push({element:"script",src:"mglass.js"}),b.__super__.constructor.call(this,a),this.jsonsrc=a.jsonsrc,this.src=a.src,!this.cdn_subdomains.length||k||l||(this.src=a.src.replace(/\/[^.]*/,"//"+this.cdn_subdomains[0]))}var d,f,g,h,i,j,k,l,m,n,o;return e(b,a),l=!1,n=void 0,m=null,k=-1!==window.location.pathname.indexOf("/bucket"),o=6,b.prototype.isSupportedMagnifier=function(a){return 1===["mglass","cloudzoom"].filter(function(b){return b===a}).length},b.prototype.setMagnifierLibName=function(){var a;m="mglass",a=[],configuration.experiences&&(a=configuration.experiences.filter(function(a){return"loupe3DFullInspection"===a.atom})),1===a.length&&a[0].magnifierLibName&&this.isSupportedMagnifier(a[0].magnifierLibName)&&(m=a[0].magnifierLibName)},b.prototype.preloadAssets=function(a){var b,c,d,e,f,g,h,i,j;for(c=0,e=this.resources.map(function(a){return"script"===a.element}),f=function(a){if(++c===e.length-1&&void 0!==a)return setTimeout(function(b){return function(){return a()}}(),500)},i=this.resources,j=[],g=0,h=i.length;g<h;g++)d=i[g],b=document.createElement(d.element),"script"===d.element?($(document.body).append(b),b.onload=b.onreadystatechange=function(){return f(a)},b.src=this.resourcesPrefix+d.src+cacheVersion,j.push(b.type="text/javascript")):(b.href=this.resourcesPrefix+d.src+cacheVersion,b.rel="stylesheet",b.type="text/css",j.push($(document.head).prepend(b)));return j},b.prototype.convertElement=function(){var a;return a=this.resourcesPrefix+"3dfullinspection.html"+cacheVersion,$.get(a,function(a){return function(b){var c;return c=$(b),"false"===a.element.attr("menu")&&$(".buttons",c).remove(),"false"===a.element.attr("coordinates")&&$(".stone_number",c).remove(),a.conteiner=c,a.element.css({width:"100%",height:"100%"}),a.element.append(c)}}(this)),this.element},b.prototype.first_init=function(){var a,b,c,e,f,g;return this.first_init_defer=$.Deferred(),this.full_init_defer=$.Deferred(),g="",f=function(a){return function(b){return a.viewerBI=new i({first_init:a.first_init_defer,full_init:a.full_init_defer,src:a.src,x:0,y:b.vertical_angles.indexOf(90),stone:g,friendlyName:"temp",cdn_subdomains:a.cdn_subdomains,metadata:b,debug:!1,resourcesPrefix:a.resourcesPrefix}),a.UIlogic=new h(a.viewerBI,{auto_play:!0}),a.UIlogic.go()}}(this),l?(b=this.src.substr(0,this.src.indexOf("ImageRepo")),c=this.src.slice(this.src.indexOf("ImageRepo/")+10,this.src.lastIndexOf("/")),e=c.split("/"),a=b+"GetLocalJson?stoneId="+e[0]+"&measureId="+e[1]+"&viewer=inspection"):a=this.src+this.jsonsrc,$.getJSON(a,function(a){return function(b){var c;return g=b.StoneId+"_"+b.MeasurementId,b=l?JSON.parse(b):b,c=new d({size_x:b.number_of_x_images,flip_from_y:b.number_of_y_images,background:b.background,vertical_angles:b.vertical_angles,num_focus_points:b.num_focus_points,shooting_parameters:b.shooting_parameters,image_size:b.ImageSize||480,sprite_factor:b.SpriteFactor||4}),a.preloadAssets(function(){return f(c)})}}(this)).fail(function(a){return function(){var b;return b=function(){return $(".inspect-stone",a.element).length?($(".inspect-stone",a.element).addClass("no_stone"),$(".buttons",a.element).remove(),$(".stone_number",a.element).remove(),$(".inspect-stone",a.element).css("background","url('"+a.callbackPic+"') no-repeat center center"),$(".inspect-stone",a.element).css("width","480px"),$(".inspect-stone",a.element).css("height","480px")):setTimeout(b,50)},b(),a.first_init_defer.resolve(a)}}(this)),this.first_init_defer},b.prototype.full_init=function(){return this.viewerBI||this.full_init_defer.resolve(this),this.viewerBI?(void 0!==this.element.attr("active")&&(this.viewerBI.preloader.go(),this.viewerBI.show(!0)),this.full_init_defer):this.full_init_defer},b.prototype.nextImage=function(){return console.log("FullInspection: nextImage")},b.prototype.play=function(){return this.element.attr("active","true")},b.prototype.stop=function(){return this.element.attr("active","false")},g=4,j={sprite_factors:"2,4",image_quality:70,sprite_quality:30,image_size:480,speed:240,initial_focus:0,initial_zoom:"large",background:"000000",machineEndPoint:"http://localhost:8735/Sarin.Agent",local:!1},d=function(){function a(a){var b,c,d,e,f,h,i,k,l,m,n,o,p,q,r,s,t,u,v;for(t=["background","initial_zoom","sprite_factors","shooting_parameters","local"],n=0,q=t.length;n<q;n++)k=t[n],this[k]=a[k]||j[k];for(u=["size_x","flip_from_y","num_focus_points","image_quality","sprite_quality","speed","initial_focus","speed","image_size","sprite_factor"],o=0,r=u.length;o<r;o++)k=u[o],this[k]=a[k]||j[k];if(a.vertical_angles)this.vertical_angles=a.vertical_angles;else{for(m=[],h=0;h<this.flip_from_y;)m[h]=parseInt(h/(this.flip_from_y-1)*180-90),h++;this.vertical_angles=m}if(this.background=this.background.replace("#",""),this.sprite_factors=function(){var a,b,c,e;for(c=this.sprite_factors.split(","),e=[],a=0,b=c.length;a<b;a++)d=c[a],e.push(parseInt(d));return e}.call(this),this.sprite_factors.sort(),this.size_y=2*(this.flip_from_y-1),this.num_images=this.size_x*this.flip_from_y,this.num_sprite_images=this.num_images/g,this.sprite_num_y=Math.floor(Math.sqrt(this.num_sprite_images)),this.sprite_num_x=Math.ceil(this.num_sprite_images/this.sprite_num_x),null!=this.shooting_parameters){this.focus_points=[],this.vertical_angles=[];for(b in this.shooting_parameters){this.vertical_angles.push(parseInt(b));for(f in this.shooting_parameters[b].Focuses)-1===this.focus_points.indexOf(this.shooting_parameters[b].Focuses[f])&&this.focus_points.push(this.shooting_parameters[b].Focuses[f])}for(this.focus_points.sort(function(a,b){return a-b}),this.vertical_angles.sort(function(a,b){return a-b}),this.focus_index={},v=this.focus_points,i=p=0,s=v.length;p<s;i=++p)e=v[i],this.focus_index[e]=i;this.angle_focus_info=function(){var a,d,e,g;for(e=this.vertical_angles,g=[],a=0,d=e.length;a<d;a++)b=e[a],c=this.shooting_parameters[""+b],l=function(){var a,b,d,e;for(d=c.Focuses,e=[],b=0,a=d.length;b<a;b++)f=d[b],e.push(this.focus_index[f]);return e}.call(this),g.push({default:this.focus_index[c.DefaultFocus],supported:l});return g}.call(this)}}return a.prototype.default_focus=function(a,b){return null!=this.angle_focus_info?this.angle_focus_info[this.normal_y(b)].default:0},a.prototype.normal_y=function(a){var b;return b=a,a>Math.floor(this.size_y/2)&&(b=this.size_y-a),b},a.prototype.supported_focus_indexes=function(a,b){var c;return null!=this.shooting_parameters?this.angle_focus_info[this.normal_y(b)].supported:function(){c=[];for(var a=0,b=this.num_focus_points-1;0<=b?a<=b:a>=b;0<=b?a++:a--)c.push(a);return c}.apply(this)},a.prototype.number_focuses=function(a){},a.prototype.next_focus=function(a,b,c){var d,e;return d=this.supported_focus_indexes(a,b),e=d.indexOf(c),e===d.length-1?null:d[e+1]},a.prototype.prev_focus=function(a,b,c){var d,e;return d=this.supported_focus_indexes(a,b),e=d.indexOf(c),0===e?null:d[e-1]},a.prototype.image_name=function(a,b,c){return null==c&&(c=this.default_focus(a,this.normal_y(b))),null!=this.shooting_parameters?a+"_"+this.normal_y(b)+"_"+c:c*this.num_images+(this.normal_y(b)*this.size_x+a)},a.prototype.image_class=function(a,b,c){return null==c&&(c=this.default_focus(a,this.normal_y(b))),null!=this.shooting_parameters?a+"_"+this.normal_y(b)+"_"+j.sprite_quality:c*this.num_images+(this.normal_y(b)*this.size_x+a)},a.prototype.focus_label=function(){return null!=this.shooting_parameters?"":"_0"},a.prototype.hq_trans=function(){return null!=this.shooting_parameters?"c_scale,h_480,q_"+this.image_quality+",w_480":"q_"+this.image_quality},a.prototype.inc_x=function(a,b){return(a+b+this.size_x)%this.size_x},a.prototype.inc_y=function(a,b){return(a+b+this.size_y)%this.size_y},a.prototype.multi_focus=function(){return null!=this.shooting_parameters||this.num_focus_points>1},a}(),f=function(){function a(a,b,c,d){this.callback=a,this.widget=b,this.metadata=c,this.version=0,this.dest=d.src,this.clear_queue(),this.images={},this.totals={},this.stone=d.stone,this.cdn_subdomains=void 0!==window.cdn_subdomains?window.cdn_subdomains:[],this.density=d.density||1,this.fetchTimer,this.shard_imgs_loaded={all:0},!this.cdn_subdomains.length||k||l||(this.shard_imgs_loaded=this.cdn_subdomains.reduce(function(a,b,c){return a[b]=0,a},{}))}return a.prototype.cache_key=function(){return this.trans},a.prototype.configure=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n;for(this.trans=a,this.x=b,this.y=c,(f=this.images)[k=this.cache_key()]||(f[k]={}),e=0,this.clear_queue(),b=g=0,l=this.metadata.size_x-1;0<=l?g<=l:g>=l;b=0<=l?++g:--g)for(c=h=0,m=this.metadata.flip_from_y-1;0<=m?h<=m:h>=m;c=0<=m?++h:--h)for(n=this.metadata.supported_focus_indexes(b,c),i=0,j=n.length;i<j;i++)d=n[i],this.has(b,c,d)&&this.loaded++,e++;return this.totals[this.cache_key()]=e},a.prototype.clear_queue=function(){return this.version++,this.loaded=0,this.queue={}},a.prototype.go=function(){var a,b,c,d,e,f,g,h,i,j,m,n;for(d=f=0,j=this.metadata.size_x-1;0<=j?f<=j:f>=j;d=0<=j?++f:--f)for(e=g=0,m=this.metadata.flip_from_y-1;0<=m?g<=m:g>=m;e=0<=m?++g:--g)for(n=this.metadata.supported_focus_indexes(d,e),h=0,i=n.length;h<i;h++)a=n[h],this.has(d,e,a)||(b="all",c=this.src(d,e,a),!this.cdn_subdomains.length||k||l||(b=this.cdn_subdomains[(d+e)%this.cdn_subdomains.length],c=this.replace_subdomain(c,b)),this.queue[b]||(this.queue[b]=[]),this.queue[b].push({src:c,x:d,y:e,focus:a,trans:this.trans,version:this.version}));return this.prioritize(),this.preload(this.queue)},a.prototype.replace_subdomain=function(a,b){return a.replace(/\/[^.]*/,"//"+b)},a.prototype.circle_distance=function(a,b,c){return Math.min((a-b+c)%c,(b-a+c)%c)},a.prototype.prioritize=function(){var a,b,c,d,e,f,h,i;h=this.queue,i=[];for(d in h){for(c=h[d],e=0,f=c.length;e<f;e++)a=c[e],b=this.circle_distance(a.x,this.x,this.metadata.size_x)+50*Math.pow(this.circle_distance(a.y,this.y,this.metadata.flip_from_y),2),a.x%g!=0&&(b+=this.metadata.size_x/2),a.priority=b;i.push(c.sort(function(a,b){return b.priority-a.priority}))}return i},a.prototype.load_image=function(a,b,c,d,e,f){var g,h,i,j;return g=this.cache_key(),i=this.trans,j=this.version,h=new Image,h.src=d,h.onload=function(h){return function(){var k,l;if(k=h.metadata.image_name(a,b,c),l=!h.images[g][k],h.images[g][k]=!0,h.version===j&&(l&&h.loaded++,h.callback(i,a,b,c,d),++h.shard_imgs_loaded[f],!f||h.shard_imgs_loaded[f]>=o))return h.preload(e,f)}}(this),h.onerror=h.onload},a.prototype.total=function(){return this.totals[this.cache_key()]},a.prototype.load_img_shard=function(a,b){var c,d,e;for(d=0,e=[];d<o;)c=a[b].pop(),c&&this.load_image(c.x,c.y,c.focus,c.src,a,b),e.push(++d);return e},a.prototype.preload=function(a,b){if(a&&0!==a.length)if(b&&this.shard_imgs_loaded[b]>=o&&(this.shard_imgs_loaded[b]=0),b)0===this.shard_imgs_loaded[b]&&this.load_img_shard(a,b);else for(b in a)this.load_img_shard(a,b)},a.prototype.has=function(a,b,c){return null==c&&(c=this.metadata.default_focus(a,b)),!0===this.images[this.cache_key()][this.metadata.image_name(a,b,c)]},a.prototype.src=function(a,b,c,d){var e,f,g;return null==d&&(d=""),a=Math.floor(a/this.density)*this.density,e={format:"jpg",quality:null!=(f=d.quality)?f:j.image_quality,height:null!=(g=d.height)?g:j.image_size},l?this.dest+"/merge/img_"+this.metadata.image_name(a,b,c)+".jpg":this.dest+"/"+e.height+"_"+e.quality+"/img_"+this.metadata.image_name(a,b,c)+".jpg"},a.prototype.fetch=function(a,b,c){var d;return null==c&&(c=null),d=300,this.has(a,b,c)&&(d=0),clearTimeout(this.fetchTimer),this.fetchTimer=setTimeout(function(d){return function(){var e,f,g,h,i;return a!==d.x&&b!==d.y?(d.x=a,d.y=b,void d.fetch(a,b,c)):(h=[d.x,a],e=h[0],d.x=h[1],i=[d.y,b],f=i[0],d.y=i[1],(d.circle_distance(a,e,d.metadata.size_x)>20||b!==f)&&(d.widget.trigger("preload_xy",{x:a,y:b}),d.prioritize()),g=d.src(a,b,c),d.has(a,b,c)?d.callback(d.trans,a,b,c,g):d.load_image(a,b,c,g))}}(this),d)},a}(),i=function(){function a(a){this.img_ready=c(this.img_ready,this),this.widget=$(".inspect-stone"),this.viewport=$(".inspect-stone > .viewport"),this.inited=!1,this.first_hit=!0,this.debug=a.debug,this.metadata=a.metadata,this.stone=a.stone,this.friendlyName=a.friendlyName,this.density=a.density||1,this.x=a.x,this.y=a.y,this.focus=this.metadata.initial_focus,this.preloader=new f(this.img_ready,this.widget,this.metadata,a),this.mode="large",this.inspection=!1,this.dest=a.src,this.first_init_defer=a.first_init,this.full_init_defer=a.full_init,this.resourcesPrefix=a.resourcesPrefix,this.reset(),this.context=$("#main-canvas")[0].getContext("2d")}return a.prototype.reset=function(){return this.stop(),this.widget.trigger("reset")},a.prototype.configure=function(a){return this.trans=a,this.stop(),this.preloader.configure(this.trans,this.x,this.y)},a.prototype.img_ready=function(a,b,c,d,e){var f,g;return this.preloader.total()===this.preloader.loaded&&this.full_init_defer.resolve(this),this.first_hit&&(this.first_hit=!1,this.first_init_defer.resolve(this)),this.widget.trigger("high_quality",{loaded:Math.floor(this.preloader.loaded/this.density),total:Math.floor(this.preloader.total()/this.density)}),b===this.x&&c===this.y&&d===this.focus&&a===this.trans?(f=this.widget[0].className,this.widget.removeClass("sprite"),g=$("#main-image").attr("src")!==e,!this.preloader.cdn_subdomains.length||k||l||(e=this.preloader.replace_subdomain(e,this.preloader.cdn_subdomains[(b+c)%this.preloader.cdn_subdomains.length])),(g||f!==this.widget[0].className)&&($("#main-image").attr({src:e}),$("#main-image")[0].onload=function(a){return $("#main-canvas")[0].getContext("2d").drawImage(a.target,0,0,480,480)},$("#main-canvas")[0].getContext("2d").drawImage($("#main-image")[0],0,0,480,480)),this.viewport.attr({class:this.flip_class()})):this.viewport,this.viewport},a.prototype.left=function(a){if(null==a&&(a=1),void 0===this.MGlass||!this.MGlass.isActive)return this.direction="left",this.move_horizontal(a)},a.prototype.right=function(a){if(null==a&&(a=1),void 0===this.MGlass||!this.MGlass.isActive)return this.direction="right",this.move_horizontal(a)},a.prototype.move_horizontal=function(a){if(this.active)return a=Math.ceil(a/this.density)*this.density,"right"===this.direction&&(a=-a),this.x=this.metadata.inc_x(this.x,a),this.show()},a.prototype.up=function(a){var b,c;if(null==a&&(a=1),this.active&&(void 0===this.MGlass||!this.MGlass.isActive))return c=this.flip(),this.direction="up",this.y=this.metadata.inc_y(this.y,-a),c!==this.flip()&&(b=(this.x+Math.floor(this.metadata.size_x/2))%this.metadata.size_x,this.x=this.metadata.inc_x(this.x,b-this.x)),this.fix_focus(),this.show()},a.prototype.down=function(a){var b,c;if(null==a&&(a=1),this.active&&(void 0===this.MGlass||!this.MGlass.isActive))return c=this.flip(),this.direction="down",this.y=this.metadata.inc_y(this.y,a),c!==this.flip()&&(b=(this.x+Math.floor(this.metadata.size_x/2))%this.metadata.size_x,this.x=this.metadata.inc_x(this.x,b-this.x)),this.fix_focus(),this.show()},a.prototype.flip=function(){return this.y>=this.metadata.flip_from_y},a.prototype.flip_class=function(){return this.flip()?"viewport flip":"viewport"},a.prototype.fix_focus=function(){if(-1===this.metadata.supported_focus_indexes(this.x,this.y).indexOf(this.focus))return this.focus=this.metadata.default_focus(this.x,this.y)},a.prototype.at_top=function(){return this.y===this.metadata.flip_from_y-1},a.prototype.top_view=function(){var a;if(this.direction="up",a=this.metadata.vertical_angles.indexOf(90),-1!==a&&(this.y=a),this.fix_focus(),this.active)return this.show()},a.prototype.at_bottom=function(){return this.y===this.metadata.vertical_angles.indexOf(-90)},a.prototype.bottom_view=function(){var a;if(this.direction="up",a=this.metadata.vertical_angles.indexOf(-90),-1!==a&&(this.y=a),this.fix_focus(),this.active)return this.show()},a.prototype.at_middle=function(){return this.y===this.metadata.vertical_angles.indexOf(0)},a.prototype.magnify=function(){},a.prototype.middle_view=function(){var a;if(this.direction="up",a=this.metadata.vertical_angles.indexOf(0),-1!==a&&(this.y=a),this.fix_focus(),this.active)return this.show()},a.prototype.view_mode=function(){return this.at_top()?"top":this.at_middle()?"side":this.at_bottom()?"bottom":null},a.prototype.stop=function(){if(this.player)return clearInterval(this.player)},a.prototype.play=function(){return this.stop(),this.player=setInterval(function(a){return function(){return a.left(),a.metadata.speed*a.density}}(this))},a.prototype.show=function(a){var b,c,d,e;if(this.widget.trigger("xy",{x:this.x,y:this.y}),this.timeout&&clearTimeout(this.timeout),0,d=this.x,e=this.flip()?this.metadata.size_y+1-this.y:this.y,!a){for(c="left"===this.direction?1:-1,b=!this.preloader.has(d,e);!this.preloader.has(d,e)&&d%g!=0;)d=this.metadata.inc_x(d,c);if(b&&("up"!==this.direction&&"down"!==this.direction||(this.x=d),this.timeout=setTimeout(function(a){return function(){return a.timeout=null,a.show(!0)}}(this),50),d%g==0))return this.load_from_sprite();this.load_from_sprite()}return this.preloader.fetch(this.x,this.y,this.focus)},a.prototype.sprite_info=function(a,b,c){var d;return null==a&&(a=this.sprite_size),null==b&&(b=this.x),null==c&&(c=this.y),d="zoom_"+this.size+"_"+a+"_"+j.sprite_quality+"_",$("#info_inspection").removeClass().addClass(""+d+this.stone+"_img_"+this.metadata.image_name(b,c))},a.prototype.load_from_sprite=function(){var a,b,c,d,e,f,g,h,i,j,k;if(c=this.sprite_info(),b=c.css("background-position-y"),a=c.css("background-position-x"),k=c.css("background-position").split(" "),a=k[0],b=k[1],f=parseInt(b.replace(/px/,"")),e=parseInt(a.replace(/px/,"")),i=-f/this.sprite_size,h=-i*this.size*this.sprite_size/this.sprite_size,d=e*this.size/this.sprite_size,g=this.get_sprite_image(c))return this.widget.addClass("sprite"),j=Math.floor(this.size/this.metadata.sprite_factor),$("#sprite-image").attr({src:g,rawdata_size:this.metadata.image_size}).css({top:h,left:d})[0].onload=function(){var a,b;return parseInt($(this).attr("rawdata_size")),a=-1*parseInt($(this).css("left").match(/\d+/g)[0]),b=-1*parseInt($(this).css("top").match(/\d+/g)[0]),$("#main-canvas")[0].getContext("2d").drawImage(this,a,b,j,j,0,0,480,480)},$("#main-canvas")[0].getContext("2d").drawImage($("#sprite-image")[0],-1*e,-1*f,j,j,0,0,480,480),this.viewport.attr({class:this.flip_class()})},a.prototype.get_sprite_image=function(a){var b;return b=a.css("background-image").match(/url\("?([^"]*)"?\)/),b?b[1]:null},a.prototype.load_stylesheet=function(a,b,c){var d,e,f;return j.local?void c():(0===$('link[href="'+a+'"]').length&&(e=$("<link></link>").attr({href:a,rel:"stylesheet",type:"text/css"}),e.appendTo($("head"))),f=this.size,(d=function(a){return function(){var e,g,h;return g=a.sprite_info(b,0,0),h=a.get_sprite_image(g),null!=h?(e=new Image,e.src=h,e.startLoadStamp=new Date,e.complete?e.cached=!0:e.cached=!1,e.onload=function(){return e.endLoadStamp=new Date,e.endLoadStamp.getTime()-e.startLoadStamp.getTime(),f===a.size&&a.widget.find("#sprite-image").css({width:a.metadata.sprite_num_x*b*a.size/b,height:a.metadata.sprite_num_y*b*a.size/b}),c()}):setTimeout(d,50)}}(this))())},a.prototype.zoom_large=function(){return this.widget.removeClass("small").addClass("large"),this.mode="large",this.zoom(this.metadata.image_size,this.metadata.hq_trans(),0)},a.prototype.zoom_small=function(){return this.widget.removeClass("large").addClass("small"),this.mode="small",this.zoom(320,"c_scale,h_320,q_"+this.metadata.image_quality+",w_320",0)},a.prototype.mode=function(){return this.mode},a.prototype.change_focus=function(a){return this.focus=a,this.show()},a.prototype.next_focus=function(){return this.metadata.next_focus(this.x,this.y,this.focus)},a.prototype.prev_focus=function(){return this.metadata.prev_focus(this.x,this.y,this.focus)},a.prototype.zoom=function(a,b){var c,d;if(this.currentDownloadImagesLabel=a+"_"+b,this.currentDownloadImagesTimeStart=new Date,this.size=a,d=this.metadata.sprite_factors,d[0],d[1],this.sprite_size=Math.floor(this.size/this.metadata.sprite_factor),this.configure(b),{crop:"scale",format:"css",fetch_format:"jpg",type:"sprite",viewer:"Inspection",height:this.size,width:this.size,quality:this.metadata.sprite_quality,background:"#"+this.metadata.background},c=this.dest+"/InspectionSprites/"+this.size+"_"+this.sprite_size+"_"+this.metadata.sprite_quality+"_sprite.css",this.reset(),this.show(!0),!l)return this.load_stylesheet(c,this.sprite_size,function(a){return function(){return a.widget.trigger("low_quality")}}(this))},a}(),h=function(){function a(a,b){this.viewer=a,this.keyDownFunc=c(this.keyDownFunc,this),this.auto_play=b.auto_play}return a.prototype.disable_button=function(a){return $(a).each(function(a){return function(a,b){return $(b).data("enabled",!1),$(b).addClass("disabled")}}())},a.prototype.enable_button=function(a){return $(a).each(function(a){return function(a,b){return $(b).data("enabled",!0),$(b).removeClass("disabled")}}())},a.prototype.activate_button=function(a){return $(a).each(function(a){return function(a,b){return $(b).data("active",!0),$(b).addClass("selected")}}())},a.prototype.inactivate_button=function(a){return $(a).each(function(a){return function(a,b){return $(b).data("active",!1),$(b).removeClass("selected")}}())},a.prototype.update_focus_buttons=function(){if(this.disable_button(".focus_out"),this.disable_button(".focus_in"),this.inactivate_button(".focus_out"),this.inactivate_button(".focus_in"),$("#focus_label_quantity").html(this.viewer.metadata.angle_focus_info[this.viewer.metadata.normal_y(this.viewer.y)].supported.length),$("#focus_label_current").html(this.viewer.focus+1),null!=this.viewer.next_focus()||null!=this.viewer.prev_focus())return null!=this.viewer.prev_focus()?this.enable_button(".focus_out"):(this.activate_button(".focus_out"),this.disable_button(".focus_out")),null!=this.viewer.next_focus()?this.enable_button(".focus_in"):(this.activate_button(".focus_in"),this.disable_button(".focus_in"))},a.prototype.stop=function(){return!!this.viewer.active&&(!!$(".player .pause").data("active")&&(this.activate_button($(".player .hand_tool")),this.inactivate_button($(".player .pause")),$(".player .pause").addClass("hidden"),$(".player .play").removeClass("hidden"),this.viewer.stop(),this.auto_play=!1,!1))},a.prototype.play=function(){return!!$(".player .play").data("enabled")&&($(".player .play").addClass("hidden"),$(".player .pause").removeClass("hidden"),this.activate_button($(".player .pause")),this.inactivate_button($(".player .hand_tool")),this.viewer.play(),!1)},a.prototype.initMagnify=function(a){var b,c,d,e,f,g,h,i,j,k,l;if("mglass"===m)return this.viewer.MGlass=new MGlass("main-canvas",a,{background:this.viewer.metadata.background,innerHTML:"<div class='mglass_inner_html'><div class='dummy'></div><div class='img-container'><img src='"+this.viewer.resourcesPrefix+"move_cursor.png' alt='move'/></div></div>"},arguments.callee);"cloudzoom"===m&&(i={zoomImage:a,zoomPosition:"inside",autoInside:!0,permaZoom:!0},l=$(".slider-wrap"),d=$(".slide--loupe3d"),g=$("#magnify-image-container"),h=$("#magnify-image"),b=$("#closeMagnify"),e=d.find(".content"),f=$(".viewport").hasClass("flip"),0===g.length&&(k=$(".slider-wrap").last().height(),g=$('<div id="magnify-image-container">'),g.height(k),h=$('<img id="magnify-image">'),c=$('<div id="closeMagnify-container">'),b=$('<a id="closeMagnify">&times;</a>'),c.append(b),g.append(c),g.append(h),h.css("width","100%"),1===l.length?(g.attr("class","slider-wrap"),l.before(g)):1===d.length&&(h.css("margin",0),g.attr("class","content"),g.css({padding:0,height:e.innerHeight()}),d.append(g),j=e.innerWidth()<e.innerHeight()?e.innerWidth()-15:e.innerHeight()-30-15,h.css("width",j+"px"),h.css("height",j+"px"))),h.unbind("cloudzoom_start_zoom"),h.removeClass("flip180"),f&&h.addClass("flip180"),h.bind("cloudzoom_start_zoom",function(a){return function(){var a;a=!1,setTimeout(function(){var b,c;if(!a&&($(".cloudzoom-tint").css({"background-color":"transparent"}),c=$(".cloudzoom-zoom-inside img"),c.length>0&&(c.removeClass("flip180"),f)))return b=c.attr("style"),b=b.replace("transform: translateZ(0px); ",""),c.attr("style",b),c.attr("class","flip180"),a=!0},300)}}()),h.attr("src",a),this.viewer.CloudZoom=new CloudZoom($("#magnify-image"),i),l.length>0?l.not("#magnify-image-container").css("margin-top","-5000px"):d.length>0&&e.hide(),g.show(),$(window).on("orientationchange",function(a){return function(b){if(a.viewer.CloudZoom)return a.viewer.CloudZoom.closeZoom()}}(this)),b.on("click",function(a){return function(){a.viewer.CloudZoom.closeZoom(),a.viewer.CloudZoom.destroy(),l.length>0?l.not("#magnify-image-container").css({"margin-top":0}):d.length>0&&e.show(),g.hide(),a.viewer.inspection=!1,$(".cloudzoom-zoom-inside").remove(),$(".cloudzoom-blank").remove()}}(this)))},a.prototype.deleteMagnify=function(){if(this.viewer.MGlass&&this.viewer.MGlass.Delete(),this.viewer.CloudZoom)return this.viewer.CloudZoom.destroy()},a.prototype.keyDownFunc=function(a){switch(a.keyCode){case 32:$(".player .pause").data("active")?this.stop():this.play();break;case 37:this.stop(),void 0===this.viewer.MGlass?this.viewer.left():this.viewer.MGlass.isActive||this.viewer.left();break;case 38:this.stop(),void 0===this.viewer.MGlass?this.viewer.up():this.viewer.MGlass.isActive||this.viewer.up();break;case 39:this.stop(),void 0===this.viewer.MGlass?this.viewer.right():this.viewer.MGlass.isActive||this.viewer.right();break;case 40:this.stop(),void 0===this.viewer.MGlass?this.viewer.down():this.viewer.MGlass.isActive||this.viewer.down();break;case 49:void 0===this.viewer.MGlass?this.viewer.top_view():this.viewer.MGlass.isActive||this.viewer.top_view();break;case 50:void 0===this.viewer.MGlass?this.viewer.middle_view():this.viewer.MGlass.isActive||this.viewer.middle_view();break;case 51:void 0===this.viewer.MGlass?this.viewer.bottom_view():this.viewer.MGlass.isActive||this.viewer.bottom_view();break;case 107:if(!this.viewer.active)return!1;if(null==this.viewer.next_focus())return!1;this.viewer.change_focus(this.viewer.next_focus()),this.update_focus_buttons();break;case 109:if(!this.viewer.active)return!1;if(null==this.viewer.prev_focus())return!1;this.viewer.change_focus(this.viewer.prev_focus()),this.update_focus_buttons();break;default:return!0}return!1},a.prototype.go=function(){return this.viewer.inited=!0,this.update_focus_buttons(),this.mouse_x=null,this.mouse_y=null,$(window).keydown(function(a){return function(b){return a.keyDownFunc(b)}}(this)),this.viewer.widget.focus().addTouch().mousedown(function(a){return function(b){return a.mouse_x=b.clientX,a.mouse_y=b.clientY,b.preventDefault(),!0}}(this)).elasticmousedrag(function(a){return function(b){var c,d,e;if(null!==a.mouse_x&&null!==a.mouse_y)return a.stop(),e=4,c=Math.round(Math.abs(b.clientX-a.mouse_x)*e/100),c>0&&(b.clientX>a.mouse_x?a.viewer.right(c):a.viewer.left(c),a.mouse_x=b.clientX),d=Math.round(Math.abs(b.clientY-a.mouse_y)*e/50),d>0?(b.clientY>a.mouse_y?a.viewer.down(d):a.viewer.up(d),a.mouse_y=b.clientY):void 0}}(this)).click(function(){return this.focus()}).bind("reset",function(a){return function(){return $(".display > div").html(""),a.viewer.active=!1,a.inactivate_button($(".button")),a.disable_button($(".button")),$(".player .pause").addClass("hidden"),$(".player .play").removeClass("hidden"),$(".progress").stop(!0).css({opacity:100}).show().addClass("active"),$(".progress").find(".progress_bar").css("width","0%"),$(".progress").find(".progress_percent").html("0%"),"large"===a.viewer.mode?(a.inactivate_button($(".small_link")),a.enable_button($(".small_link")),a.activate_button($(".large_link")),a.disable_button($(".large_link"))):(a.activate_button($(".small_link")),a.enable_button($(".large_link")),a.inactivate_button($(".large_link")),a.disable_button($(".small_link"))),a.update_focus_buttons()}}(this)).bind("low_quality",function(a){return function(){return $(".low_quality").html("Low quality images loaded"),a.viewer.active=!0,a.enable_button($(".buttons li")),!1===a.viewer.metadata.vertical_angles.indexOf(90)&&a.disable_button(".top"),!1===a.viewer.metadata.vertical_angles.indexOf(0)&&a.disable_button(".middle"),!1===a.viewer.metadata.vertical_angles.indexOf(-90)&&a.disable_button(".bottom"),a.viewer.top_view(),a.update_focus_buttons()}}(this)).bind("med_quality",function(a){return function(){return $(".med_quality").html("Medium quality images loaded")}}()).bind("high_quality",function(a){return function(b,c){var d,e;if($(".high_quality").html(c.loaded+" / "+c.total),a.viewer.active=!0,d=Math.round(100*c.loaded/c.total),e=$(".progress"),$(e).find(".progress_bar").css("width",Math.min(d,98)+"%"),$(e).find(".progress_percent").html(d+"%"),100===d&&$(e).animate({opacity:0},2e3),c.loaded===c.total&&!$(".player .play").data("enabled")&&((new Date).getTime()-a.viewer.currentDownloadImagesTimeStart.getTime(),a.enable_button($(".player .play, .player .pause")),a.auto_play))return a.play()}}(this)).bind("xy",function(a){return function(b,c){if($(".xy").html((a.viewer.metadata.multi_focus()?a.viewer.focus+":":"")+c.y+":"+c.x),a.update_focus_buttons(),a.inactivate_button($(".buttons li")),a.viewer.view_mode())return a.activate_button($(".buttons ."+a.viewer.view_mode()))}}(this)).bind("preload_xy",function(a){return function(a,b){return $(".preload_xy").html("Preload center moved to "+b.y+":"+b.x)}}()),$(".inspect-stone").css("background-color","#"+this.viewer.metadata.background),"000"!==this.viewer.metadata.background&&"000000"!==this.viewer.metadata.background&&"black"!==this.viewer.metadata.background&&$(".inspect-stone").addClass("dark"),this.viewer.debug&&$(".display").show(),$(".player .play").click(function(a){return function(){return a.play()}}(this)),$(".player .hand_tool, .player .pause").click(function(a){return function(){return a.stop()}}(this)),$(".buttons li:not(.magnify, .clickable, .focus_out, .focus_in)").click(function(a){return function(b){if($(b.target).data("button"))return!!a.viewer.active&&(a.viewer[$(b.target).data("button")](),!1)}}(this)),$(".small_link").click(function(a){return function(){return a.viewer.zoom_small(),!1}}(this)),$(".large_link").click(function(a){return function(){return a.enable_button(".magnify"),a.viewer.zoom_large(),!1}}(this)),$(".focus_in").click(function(a){return function(){return!!a.viewer.active&&(null!=a.viewer.next_focus()&&(a.viewer.change_focus(a.viewer.next_focus()),a.update_focus_buttons(),!1))}}(this)),$(".focus_out").click(function(a){return function(){return!!a.viewer.active&&(null!=a.viewer.prev_focus()&&(a.viewer.change_focus(a.viewer.prev_focus()),a.update_focus_buttons(),!1))}}(this)),$(".magnify").click(function(a){return function(){var b;a.viewer.inspection?(a.viewer.active=!0,$(".inspect-stone").css("overflow","hidden"),$(document).unbind("mouseup"),a.deleteMagnify(),a.inactivate_button($(".magnify")),$(".buttons li:not(.magnify)").removeClass("disabled"),a.update_focus_buttons()):(a.viewer.active=!0,"mglass"===m&&$(document).mouseup(function(a){var b;if(b=$(".mglass_viewer,.magnify"),!b.is(a.target)&&0===b.has(a.target).length)return setTimeout(function(){
return $(".magnify").click()},0)}),$(".buttons li:not(.magnify)").addClass("disabled"),$(".magnify").show(),$(".inspect-stone").css("overflow","visible"),0===$("mglass_wrapper").length&&(b=a.viewer.preloader.src(a.viewer.x,a.viewer.y,a.viewer.focus,{height:0,width:0,quality:70}),a.initMagnify(b)),a.inactivate_button($(".focus_out")),a.inactivate_button($(".focus_in")),a.disable_button(".focus_out"),a.disable_button(".focus_in"),a.activate_button($(".magnify"))),a.viewer.inspection=!a.viewer.inspection}}(this)),"small"===this.viewer.metadata.initial_zoom?this.viewer.zoom_small():this.viewer.zoom_large(),this.update_focus_buttons()},a}(),b}(Viewer),this.FullInspection=a,window.queryString=function(){function a(a){var c;c=new b(a),this.getValue=function(a){var b;return b=c.params[a],null==b&&(b=c.canonicalParams[a.toLowerCase()]),b},this.count=function(){return c.count},this.hasKey=function(a){return a in c.params||a.toLowerCase()in c.canonicalParams}}return a}(),b=function(){function a(b){var c,d;c=a.getQueryStringPart(b),d=a.initParams(c),this.params=d[0],this.canonicalParams=d[1],this.count=d[2]}return a.getQueryStringPart=function(a){var b;return null!=a?(b=a.indexOf("?"),b>0?a.substring(b):""):window.location.search},a.initParams=function(a){var b,c,d,e,f,g,h,i,j,k;for(h={},c={},d=0,b=/\+/g,j=/([^&=]+)=?([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(b," "))},i=a.substring(1);f=j.exec(i);)g=e(f[1]),k=e(f[2]),h[g]=k,c[g.toLowerCase()]=k,d+=1;return[h,c,d]},a}()}).call(this);
//# sourceMappingURL=sarine.viewer.3dfullinspection.bundle.min.js.map